# Contribute a New Handler

!!! note
    This part was generated by LLM.

A Handler's core responsibility is to take over and process all subsequent traffic on a connection after it has been matched.

## Contribution Steps

### 1. Create the Handler File

In the `handler/` directory, create a new Go file. The filename should reflect the function of your handler, for example, `my_handler.go`.

### 2. Define the Configuration Struct

  - Define a configuration struct for your handler, again using `yaml` tags.
  - For example, if you wanted to create a simple logging handler:
    ```go
    type LogHandlerConfig struct {
    	Message string `yaml:"message"`
    }
    ```

### 3. Implement the Handler Interface

  - Your Handler struct must implement the `handler.Handler` interface, which has a single method:
    ```go
    type Handler interface {
    	Handle(conn net.Conn)
    }
    ```
  - Implement your processing logic in the `Handle` method. **Crucially**, your handler must be responsible for **closing the connection**, typically by using `defer conn.Close()`.
  - In the `Handle` method, you can read the full data from the connection, communicate with a backend service, or perform any other operation.
    ```go
    type LogHandler struct {
    	config *LogHandlerConfig
    }

    func (h *LogHandler) Handle(conn net.Conn) {
    	defer conn.Close()
    	zap.L().Info(h.config.Message, zap.String("remote_addr", conn.RemoteAddr().String()))

    	// Consume remaining data on the connection to avoid issues
    	io.Copy(io.Discard, conn)
    }
    ```

### 4. Create the Factory Function

  - Write a **factory function** that is responsible for creating an instance of your Handler from a YAML node.
  - The function must adhere to the `handler.HandlerFactory` signature: `func(yaml.Node) (Handler, error)`.
  - In the factory function, use the `Decode` method on `yaml.Node` to parse the configuration.
    ```go
    func newLogHandler(parameter yaml.Node) (Handler, error) {
    	cfg := &LogHandlerConfig{}
    	if err := parameter.Decode(cfg); err != nil {
    		return nil, fmt.Errorf("failed to decode log handler config: %v", err)
    	}
    	return &LogHandler{config: cfg}, nil
    }
    ```

### 5. Register Your Handler

  - In the `init()` function of your file, use the `handler.Register` function to register your handler.
  - The registration name (the first parameter) will be the `handler.type` value that users will use in their configuration.
    ```go
    func init() {
    	Register("log", newLogHandler)
    }
    ```

### 6. Add Documentation

  - Add clear YAML configuration examples for your new handler.
